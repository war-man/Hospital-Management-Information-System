@model Caresoft2._0.CustomData.EMR_OPD_Data


@{
    var myProfile = new CaresoftHMISDataAccess.MCHFamilyPlaning();

    if (Model.OpdRegister.MCHFamilyPlanings != null)
    {
        myProfile = Model.OpdRegister.MCHFamilyPlanings
            .OrderByDescending(e => e.Id).FirstOrDefault();
    }

    var contraceptive = (List<CaresoftHMISDataAccess.MasterContraceptive>)ViewBag.MasterContraceptives;

    var tests = (List<CaresoftHMISDataAccess.MasterPostNatalTest>)ViewBag.MasterPostNatalTests;

    ViewBag.WideView = true;
    ViewBag.Title = "Family Planning";
    ViewBag.ShowTopMenu = true;
    Layout = "~/Views/Shared/_EMRForms.cshtml";
}

<div class="panel panel-primary shadow glass caresoft-panel">
    <div class="panel-heading custom-navbar">
        <p>@ViewBag.Title</p>
    </div>

    <div class="panel-body">
        <form id="family-planning" method="post" action="@Url.Action("SaveFamilyPlanning", "mch")">
            <input type="hidden" name="OPDNo" value="@Model.OpdRegister.Id" />
            <table class="table-form">
                <tr>
                    <td>
                        <label>Date</label>
                    </td>
                    <td>
                        <input type="date" name="DateAdministered" value="@DateTime.Today.ToString("yyyy-MM-dd")" id="DateAdministered" class="text-box box-lg" required>
                    </td>
                    <td>
                        <label>Contraceptives Dispensed</label>
                    </td>
                    <td>

                        <input type="text" name="ContraceptiveAdministered" id="ContraceptiveAdministered" required />
                    </td>
                </tr>
                <tr>
                    <td>
                        <label>Clinical Notes</label>
                    </td>

                    <td>
                        <textarea class="text-box box-lg" name="ClinicalNotes" id="ClinicalNotes"></textarea>
                    </td>
                    <td>
                        <label>Next Visit</label>
                    </td>
                    <td>
                        <input type="date" class="text-box box-lg" name="NextVisit" id="NextVisit" required>
                    </td>
                </tr>
                <input type="hidden" id="displayname" />
            </table>

            <!--Script references. -->
            <!--Reference the jQuery library. -->
            <script src="~/Scripts/jquery-1.12.4.js"></script>
            <script src="~/Scripts/jquery.signalR-2.4.0.min.js"></script>

            <script src="~/Scripts/toastr.js"></script>
            <!--Reference the SignalR library. -->
            <!--Reference the autogenerated SignalR hub script. -->
            <script src="signalr/hubs"></script>
            <!--Add script to update the page and send messages.-->
            <script type="text/javascript">
                $(function () {
                    // Declare a proxy to reference the hub.
                    var chat = $.connection.notificationHub;
                    // Create a function that the hub can call to broadcast messages.
                    chat.client.broadcastMessage = function (name, message) {
                        // Html encode display name and message.

                        toastr.info('New Family Planning Details Added' + name);
                        //var encodedName = $('<div />').text(name).html();
                        // var encodedMsg = $('<div />').text(message).html();
                        // Add the message to the page.
                        //  $('#discussion').append('<li><strong>' + encodedName
                        //   + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');
                    };
                    // Get the user name and store it to prepend to messages.
                   // $('#displayname').val(prompt('Enter your name:', ''));
                    // Set initial focus to message input box.
                    $('#message').focus();
                    // Start the connection.
                    $.connection.hub.start().done(function () {
                        $('#btnSubmit').click(function () {



                            // Call the Send method on the hub.
                            chat.server.send($('#displayname').val(), $('#message').val());
                            // Clear text box and reset focus for next comment.
                            $('#message').val('').focus();
                        });
                    });



                });
            </script>

            <div class="">
                <button type="submit" class="btn btn-sm btn-primary" id="btnSubmit" name="btnSubmit">Save</button>
                <button type="reset" class="btn btn-sm btn-primary">Cancel</button>
                @Html.ActionLink("Clinical Notes", "ClinicalNotes", new { id = @Model.OpdRegister.Id }, new { @class="btn btn-primary btn-sm",
@style = "background-color: inherit;float: right;border: none;outline: none;cursor: pointer;padding: 14px 16px;transition: 0.3s;"})
                &nbsp;
                &nbsp;
                @Html.ActionLink("Previous", "PostNatalExam", new { id = @Model.OpdRegister.Id }, new { @class="btn btn-primary btn-sm",
     @style = "background-color: inherit;float: right;border: none;outline: none;cursor: pointer;padding: 14px 16px;transition: 0.3s;"})
            </div>

            <div>
                @Html.Partial("FamilyPlanningDetails", Model.OpdRegister.MCHFamilyPlanings)
            </div>
</div>

</div>



@section scripts{




   
 
    


    <script>

        getRecentInfo();
        function getRecentInfo() {
            $.ajax({
                type: "GET",
                url: "/EMR/GetMostRecentPhysicalExam/"+@Model.Patient.Id,
                datatype: "html",
                success: function (result) {
                    $('#patient-recent-physical-info').html(result);
                }
            });
        }
    </script>
}


